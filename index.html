<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Acta Express</title>
  <link rel="manifest" href="./manifest.webmanifest" />
  <link rel="stylesheet" href="./styles.css?v=20251013-final" />
  <meta name="theme-color" content="#0ea5e9" />
  <!-- Tailwind CSS embebido para GitHub Pages -->
  <style>
    /* Tailwind CSS Core */
    *,::before,::after{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}
    ::before,::after{--tw-content:''}
    html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";font-feature-settings:normal;font-variation-settings:normal}
    body{margin:0;line-height:inherit}
    h1,h2,h3,h4,h5,h6{font-size:inherit;font-weight:inherit}
    a{color:inherit;text-decoration:inherit}
    b,strong{font-weight:bolder}
    code,kbd,samp{font-family:ui-monospace, SFMono-Regular, "SF Mono", Consolas, "Liberation Mono", Menlo, monospace;font-feature-settings:normal;font-variation-settings:normal;font-size:1em}
    small{font-size:80%}
    sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
    sub{bottom:-.25em}
    sup{top:-.5em}
    table{text-indent:0;border-color:inherit;border-collapse:collapse}
    button,input,optgroup,select,textarea{font-family:inherit;font-feature-settings:inherit;font-variation-settings:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}
    button,select{text-transform:none}
    [type=button],[type=reset],[type=submit],button{-webkit-appearance:button;background-color:transparent;background-image:none}
    :-moz-focusring{outline:auto}
    :-moz-ui-invalid{box-shadow:none}
    progress{vertical-align:baseline}
    ::-webkit-inner-spin-button,::-webkit-outer-spin-button{height:auto}
    [type=search]{-webkit-appearance:textfield;outline-offset:-2px}
    ::-webkit-search-decoration{-webkit-appearance:none}
    ::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}
    summary{display:list-item}
    blockquote,dl,dd,h1,h2,h3,h4,h5,h6,hr,figure,p,pre{margin:0}
    fieldset{margin:0;padding:0}
    legend{padding:0}
    ol,ul,menu{list-style:none;margin:0;padding:0}
    dialog{padding:0}
    textarea{resize:vertical}
    input::placeholder,textarea::placeholder{opacity:1;color:#9ca3af}
    button,[role=button]{cursor:pointer}
    disabled{cursor:default}
    img,svg,video,canvas,audio,iframe,embed,object{display:block;vertical-align:middle}
    img,video{max-width:100%;height:auto}
    [hidden]{display:none}
    
    /* Grid System */
    .grid{display:grid}
    .grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    .grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    .gap-2{gap:.5rem}
    .gap-3{gap:.75rem}
    .gap-4{gap:1rem}
    .gap-6{gap:1.5rem}
    .md\:grid-cols-2{grid-template-columns:repeat(1,minmax(0,1fr))}
    .md\:col-span-2{grid-column:span 1}
    .hidden{display:none}
    .block{display:block}
    .inline-block{display:inline-block}
    .flex{display:flex}
    .items-center{align-items:center}
    .justify-between{justify-content:space-between}
    .mt-3{margin-top:.75rem}
    .mt-4{margin-top:1rem}
    .mt-6{margin-top:1.5rem}
    .mb-2{margin-bottom:.5rem}
    .mb-4{margin-bottom:1rem}
    .p-3{padding:.75rem}
    .p-4{padding:1rem}
    .px-3{padding-left:.75rem;padding-right:.75rem}
    .py-2{padding-top:.5rem;padding-bottom:.5rem}
    .space-y-4 > * + *{margin-top:1rem}
    .space-y-6 > * + *{margin-top:1.5rem}
    .max-w-3xl{max-width:48rem}
    .mx-auto{margin-left:auto;margin-right:auto}
    .w-full{width:100%}
    .h-10{height:2.5rem}
    .rounded-md{border-radius:.375rem}
    .border{border-width:1px}
    .border-slate-300{border-color:#cbd5e1}
    .focus\:border-sky-500:focus{border-color:#0ea5e9}
    .focus\:ring-2:focus{box-shadow:0 0 0 2px rgba(14,165,233,.2)}
    .focus\:outline-none:focus{outline:2px solid transparent;outline-offset:2px}
    
    /* Colors */
    .bg-slate-50{background-color:#f8fafc}
    .text-slate-800{color:#1e293b}
    .bg-sky-600{background-color:#0284c7}
    .text-white{color:#ffffff}
    .text-slate-600{color:#475569}
    .shadow{box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06)}
    
    /* Typography */
    .text-xl{font-size:1.25rem;line-height:1.75rem}
    .text-sm{font-size:.875rem;line-height:1.25rem}
    .font-semibold{font-weight:600}
    .opacity-90{opacity:.9}
    
    /* Form Elements */
    input[type="text"],input[type="email"],input[type="number"],input[type="date"],select,textarea{
      width:100%;
      padding:.5rem .75rem;
      border:1px solid #cbd5e1;
      border-radius:.375rem;
      font-size:.875rem;
      line-height:1.25rem;
      background-color:#ffffff;
      transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    input[type="text"]:focus,input[type="email"]:focus,input[type="number"]:focus,input[type="date"]:focus,select:focus,textarea:focus{
      outline:2px solid transparent;
      outline-offset:2px;
      border-color:#0ea5e9;
      box-shadow:0 0 0 2px rgba(14,165,233,.2);
    }
    input[type="checkbox"]{
      width:1rem;
      height:1rem;
      margin-right:.5rem;
    }
    
    /* Custom Classes */
    .lbl{
      display:block;
      font-size:.875rem;
      font-weight:500;
      color:#374151;
      margin-bottom:.25rem;
    }
    .inp{
      width:100%;
      padding:.5rem .75rem;
      border:1px solid #d1d5db;
      border-radius:.375rem;
      font-size:.875rem;
      line-height:1.25rem;
      background-color:#ffffff;
      transition:border-color .15s ease-in-out,box-shadow .15s ease-in-out;
    }
    .inp:focus{
      outline:2px solid transparent;
      outline-offset:2px;
      border-color:#3b82f6;
      box-shadow:0 0 0 3px rgba(59,130,246,.1);
    }
    
    /* Responsive y Mobile-First */
    @media (max-width: 767px) {
      .mobile\:p-2{padding:.5rem}
      .mobile\:text-sm{font-size:.875rem}
      .mobile\:text-base{font-size:1rem}
      .mobile\:gap-2{gap:.5rem}
      .mobile\:gap-1{gap:.25rem}
      .mobile\:flex-col{flex-direction:column}
      .mobile\:w-full{width:100%}
      .mobile\:text-center{text-align:center}
      .mobile\:hidden{display:none}
      .mobile\:block{display:block}
      .mobile\:mt-2{margin-top:.5rem}
      .mobile\:mb-2{margin-bottom:.5rem}
      .mobile\:p-3{padding:.75rem}
      .mobile\:py-2{padding-top:.5rem;padding-bottom:.5rem}
      .mobile\:py-3{padding-top:.75rem;padding-bottom:.75rem}
      .mobile\:rounded-lg{border-radius:.5rem}
      .mobile\:shadow-md{box-shadow:0 4px 6px -1px rgba(0,0,0,.1),0 2px 4px -1px rgba(0,0,0,.06)}
      .mobile\:grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}
      .mobile\:flex-1{flex:1 1 0%}
      .mobile\:justify-end{justify-content:flex-end}
      .mobile\:items-center{align-items:center}
    }
    
    @media (min-width:768px){
      .md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
      .md\:col-span-2{grid-column:span 2}
      .md\:flex-row{flex-direction:row}
      .md\:gap-4{gap:1rem}
    }
    
    /* Mejoras visuales generales */
    .card{background:white;border-radius:.75rem;box-shadow:0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px 0 rgba(0,0,0,.06);padding:1.5rem;margin-bottom:1rem}
    .card-title{font-size:1.25rem;font-weight:600;color:#1e293b;margin-bottom:1rem;border-bottom:2px solid #e2e8f0;padding-bottom:.5rem}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:.75rem 1rem;font-size:.875rem;font-weight:500;border-radius:.5rem;transition:all 0.2s;cursor:pointer;border:none;text-decoration:none}
    .btn:hover{transform:translateY(-1px);box-shadow:0 4px 8px rgba(0,0,0,.15)}
    .btn:active{transform:translateY(0)}
    .btn-primary{background:#0ea5e9;color:white}
    .btn-primary:hover{background:#0284c7}
    .btn-success{background:#10b981;color:white}
    .btn-success:hover{background:#059669}
    .btn-warning{background:#f59e0b;color:white}
    .btn-warning:hover{background:#d97706}
    .btn-danger{background:#ef4444;color:white}
    .btn-danger:hover{background:#dc2626}
    .btn-outline{background:transparent;border:1px solid #d1d5db;color:#374151}
    .btn-outline:hover{background:#f9fafb;border-color:#9ca3af}
    .btn-ghost{background:transparent;border:1px solid #e5e7eb;color:#6b7280}
    .btn-ghost:hover{background:#f3f4f6;border-color:#d1d5db}
    .btn-sm{padding:.5rem .75rem;font-size:.75rem}
    .btn-xs{padding:.25rem .5rem;font-size:.75rem}
    .inp{width:100%;padding:.75rem;border:1px solid #d1d5db;border-radius:.5rem;font-size:.875rem;transition:border-color 0.2s}
    .inp:focus{outline:none;border-color:#0ea5e9;box-shadow:0 0 0 3px rgba(14,165,233,.1)}
    .lbl{display:block;font-size:.875rem;font-weight:500;color:#374151;margin-bottom:.5rem}
    .cursor-pointer{cursor:pointer}
    .accent-green-600{accent-color:#16a34a}
  </style>
  
  <!-- Estilos adicionales para gestiÃ³n de duplicados -->
  <style>
    .btn-xs{padding:.25rem .5rem;font-size:.75rem}
    .bg-orange-500{background-color:#f97316}
    .bg-orange-600{background-color:#ea580c}
    .bg-red-500{background-color:#ef4444}
    .bg-red-600{background-color:#dc2626}
    .bg-red-100{background-color:#fee2e2}
    .bg-red-200{background-color:#fecaca}
    .bg-orange-200{background-color:#fed7aa}
    .bg-orange-50{background-color:#fff7ed}
    .bg-orange-300{background-color:#fdba74}
    .text-orange-600{color:#ea580c}
    .text-orange-800{color:#9a3412}
    .text-red-600{color:#dc2626}
    .hover\:bg-orange-600:hover{background-color:#ea580c}
    .hover\:bg-red-600:hover{background-color:#dc2626}
    .hover\:bg-red-200:hover{background-color:#fecaca}
    .bg-slate-50{background-color:#f8fafc}
    .text-slate-600{color:#475569}
    .bg-blue-50{background-color:#eff6ff}
    .bg-blue-200{background-color:#bfdbfe}
    .text-blue-800{color:#1e40af}
    .border-blue-200{border-color:#bfdbfe}
    .accent-blue-600{accent-color:#2563eb}
    
    /* Colores adicionales para secciones */
    .bg-green-50{background-color:#f0fdf4}
    .bg-green-200{background-color:#bbf7d0}
    .text-green-700{color:#15803d}
    .border-green-200{border-color:#bbf7d0}
    
    .bg-purple-50{background-color:#faf5ff}
    .bg-purple-200{background-color:#e9d5ff}
    .text-purple-700{color:#7c3aed}
    .border-purple-200{border-color:#e9d5ff}
    
    .bg-yellow-50{background-color:#fefce8}
    .bg-yellow-200{background-color:#fef08a}
    .text-yellow-700{color:#a16207}
    .border-yellow-200{border-color:#fef08a}
    
    .bg-red-50{background-color:#fef2f2}
    .bg-red-200{background-color:#fecaca}
    .text-red-700{color:#b91c1c}
    .border-red-200{border-color:#fecaca}
    
    .bg-indigo-50{background-color:#eef2ff}
    .bg-indigo-200{background-color:#c7d2fe}
    .text-indigo-700{color:#4338ca}
    .border-indigo-200{border-color:#c7d2fe}
    
    .bg-gray-50{background-color:#f9fafb}
    .border-gray-200{border-color:#e5e7eb}
    
    /* Gradientes */
    .bg-gradient-to-r{background-image:linear-gradient(to right,var(--tw-gradient-stops))}
    .from-blue-50{--tw-gradient-from:#eff6ff;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to,rgba(239,246,255,0))}
    .to-indigo-50{--tw-gradient-to:#eef2ff}
    .from-sky-600{--tw-gradient-from:#0284c7;--tw-gradient-stops:var(--tw-gradient-from),var(--tw-gradient-to,rgba(2,132,199,0))}
    .to-blue-700{--tw-gradient-to:#1d4ed8}
  </style>
  
  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.2.0/dist/signature_pad.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-slate-50 text-slate-800">
  <header class="p-4 mobile:p-3 bg-gradient-to-r from-sky-600 to-blue-700 text-white shadow-lg">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-xl mobile:text-lg font-bold">ğŸ“‹ Acta Express</h1>
        <p class="text-sm mobile:text-xs opacity-90 mobile:hidden">Visita de fidelizaciÃ³n â€“ Firma en sitio â€“ PDF â€“ Excel maestro</p>
        <p class="text-xs opacity-90 md:hidden">Sistema de actas digitales</p>
      </div>
      <div class="flex items-center gap-2">
        <a href="./dashboard.html" class="text-xs bg-white/20 px-2 py-1 rounded-full hover:bg-white/30 transition mobile:hidden">
          ğŸ“Š Dashboard
        </a>
        <span class="text-xs bg-white/20 px-2 py-1 rounded-full mobile:hidden">PWA</span>
      </div>
    </div>
  </header>

  <main class="p-4 mobile:p-2 space-y-4 mobile:space-y-3 max-w-4xl mx-auto">
    <!-- Aviso PWA / offline -->
    <div id="pwaHint" class="hidden bg-amber-50 border border-amber-200 p-3 rounded text-amber-700 text-sm"></div>

    <!-- Config rÃ¡pida -->
    <section class="card mobile:p-3">
      <h2 class="card-title mobile:text-lg">âš™ï¸ ConfiguraciÃ³n</h2>
      <div class="grid gap-3 md:grid-cols-2">
        <div>
          <label class="lbl">ğŸ‘¤ Mi nombre (Ejecutivo)</label>
          <input id="cfgEjecutivo" class="inp mobile:text-base" placeholder="Tu nombre completo" />
        </div>
        <div>
          <label class="lbl">ğŸ“§ Mi correo (CC)</label>
          <input id="cfgCorreo" class="inp mobile:text-base" type="email" placeholder="tucorreo@empresa.com" />
        </div>
        <div class="md:col-span-2 flex items-center gap-2 p-2 bg-slate-50 rounded-lg">
          <input id="cfgGeo" type="checkbox" class="accent-sky-600" />
          <label for="cfgGeo" class="text-sm">ğŸ“ Incluir ubicaciÃ³n (GPS) en las actas</label>
        </div>
        <div class="md:col-span-2 flex items-center gap-2 p-2 bg-green-50 rounded-lg border border-green-200">
          <input id="cfgBackupAuto" type="checkbox" class="accent-green-600" />
          <label for="cfgBackupAuto" class="text-sm">ğŸ”„ Backup automÃ¡tico habilitado</label>
        </div>
        <div class="md:col-span-2">
          <label class="lbl">â° Intervalo de backup (horas)</label>
          <select id="cfgBackupInterval" class="inp">
            <option value="6">Cada 6 horas</option>
            <option value="12">Cada 12 horas</option>
            <option value="24" selected>Cada 24 horas</option>
            <option value="48">Cada 48 horas</option>
            <option value="168">Cada semana</option>
          </select>
        </div>
        <div class="md:col-span-2 flex items-center gap-2 p-2 bg-purple-50 rounded-lg border border-purple-200">
          <input id="cfgBackupIncremental" type="checkbox" class="accent-purple-600" />
          <label for="cfgBackupIncremental" class="text-sm">ğŸ”„ Backup incremental (solo cambios)</label>
        </div>
      </div>
      <div class="mt-4 flex flex-wrap gap-2 mobile:gap-1">
        <button id="btnGuardarCfg" class="btn btn-primary mobile:flex-1 mobile:text-sm">ğŸ’¾ Guardar</button>
        <button id="btnElegirExcel" class="btn btn-outline mobile:flex-1 mobile:text-sm" title="OpciÃ³n A â€“ Android/Chrome">ğŸ“Š Excel</button>
        <button id="btnLimpiarExcelHandle" class="btn btn-ghost mobile:flex-1 mobile:text-sm">ğŸ—‘ï¸ Limpiar</button>
      </div>
      <p id="excelEstado" class="text-xs text-slate-500 mt-2 p-2 bg-slate-50 rounded"></p>
    </section>

    <!-- Formulario Express -->
    <section class="card mobile:p-3">
      <h2 class="card-title mobile:text-lg">ğŸ“ Nueva Acta de Visita</h2>
      
      <!-- Datos del Ejecutivo y UbicaciÃ³n -->
      <div class="mt-4 p-3 bg-slate-50 rounded-lg">
        <h3 class="text-sm font-semibold text-slate-700 mb-3 flex items-center gap-2">ğŸ“ Datos del Ejecutivo y UbicaciÃ³n</h3>
        <div class="grid gap-3 md:grid-cols-2">
          <div>
            <label class="lbl">Zona</label>
            <input id="zona" class="inp" placeholder="Ej: Norte, Sur, Centro" />
          </div>
          <div>
            <label class="lbl">Barrio</label>
            <input id="barrio" class="inp" placeholder="Nombre del barrio" />
          </div>
          <div class="md:col-span-2">
            <label class="lbl">DirecciÃ³n</label>
            <input id="direccion" class="inp" placeholder="DirecciÃ³n completa" />
          </div>
        </div>
      </div>

      <!-- Datos del Cliente/Negocio -->
      <div class="mt-4 p-3 bg-green-50 rounded-lg border border-green-200">
        <h3 class="text-sm font-semibold text-green-700 mb-3 flex items-center gap-2">ğŸ¢ Datos del Cliente/Negocio</h3>
        <div class="grid gap-3 md:grid-cols-2">
          <div class="md:col-span-2">
            <label class="lbl">Nombre de la Empresa</label>
            <input id="nombreEmpresa" class="inp" placeholder="Nombre de la empresa o razÃ³n social" />
          </div>
          <div>
            <label class="lbl">NÃºmero de Contrato</label>
            <input id="numeroContrato" class="inp" placeholder="NÃºmero de contrato" />
          </div>
          <div>
            <label class="lbl">NIT</label>
            <input id="cliNit" class="inp" placeholder="NIT del cliente" />
          </div>
          <div>
            <label class="lbl">Actividad EconÃ³mica</label>
            <input id="actividadEconomica" class="inp" placeholder="Ej: Comercio, Manufactura" />
          </div>
          <div>
            <label class="lbl">Consumo de kWh</label>
            <input id="consumoKwh" type="number" step="0.01" class="inp" placeholder="Consumo en kWh" />
          </div>
          <div>
            <label class="lbl">ExenciÃ³n de ContribuciÃ³n</label>
            <select id="exencionContribucion" class="inp">
              <option value="">Seleccione...</option>
              <option value="SÃ­">SÃ­</option>
              <option value="No">No</option>
            </select>
          </div>
          <div>
            <label class="lbl">Â¿Tiene consumo de kVAR?</label>
            <select id="tieneConsumoKvar" class="inp">
              <option value="">Seleccione...</option>
              <option value="SÃ­">SÃ­</option>
              <option value="No">No</option>
            </select>
          </div>
          <div id="fechaActualizacionContainer" class="hidden">
            <label class="lbl">Fecha de ActualizaciÃ³n</label>
            <input id="fechaActualizacion" type="date" class="inp" />
          </div>
          <div id="consumoKvarContainer" class="hidden">
            <label class="lbl">Consumo de kVAR</label>
            <input id="consumoKvar" type="number" step="0.01" class="inp" placeholder="Consumo en kVAR" />
          </div>
        </div>
      </div>

      <!-- Datos Persona Encargada -->
      <div class="mt-4 p-3 bg-purple-50 rounded-lg border border-purple-200">
        <h3 class="text-sm font-semibold text-purple-700 mb-3 flex items-center gap-2">ğŸ‘¤ Datos de la Persona Encargada</h3>
        <div class="grid gap-3 md:grid-cols-2">
          <div>
            <label class="lbl">Contacto (Nombre)</label>
            <input id="contactoNombre" class="inp" placeholder="Nombre del contacto" />
          </div>
          <div>
            <label class="lbl">Cargo</label>
            <input id="contactoCargo" class="inp" placeholder="Cargo" />
          </div>
          <div>
            <label class="lbl">Correo ElectrÃ³nico</label>
            <input id="contactoCorreo" class="inp" type="email" placeholder="correo@ejemplo.com" />
          </div>
          <div>
            <label class="lbl">Celular</label>
            <input id="contactoCelular" class="inp" type="tel" placeholder="NÃºmero de celular" />
          </div>
        </div>
      </div>

      <!-- Temas a Tratar -->
      <div class="mt-4 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
        <h3 class="text-sm font-semibold text-yellow-700 mb-3 flex items-center gap-2">âœ… Temas Tratados con el Cliente</h3>
        <div class="space-y-3">
          <div>
            <label class="flex items-center gap-2 text-sm mb-1">
              <input type="checkbox" id="temaEnergiaEficiente" class="accent-sky-600" />
              <span>EnergÃ­a eficiente</span>
            </label>
            <textarea id="descEnergiaEficiente" class="inp text-sm" rows="2" placeholder="Describe lo tratado sobre energÃ­a eficiente..." disabled></textarea>
          </div>
          <div>
            <label class="flex items-center gap-2 text-sm mb-1">
              <input type="checkbox" id="temaConexionEmcali" class="accent-sky-600" />
              <span>ConexiÃ³n directa con Emcali</span>
            </label>
            <textarea id="descConexionEmcali" class="inp text-sm" rows="2" placeholder="Describe lo tratado sobre conexiÃ³n directa..." disabled></textarea>
          </div>
          <div>
            <label class="flex items-center gap-2 text-sm mb-1">
              <input type="checkbox" id="temaEtiquetaRetiq" class="accent-sky-600" />
              <span>Etiqueta RETIQ</span>
            </label>
            <textarea id="descEtiquetaRetiq" class="inp text-sm" rows="2" placeholder="Describe lo tratado sobre etiqueta RETIQ..." disabled></textarea>
          </div>
          <div>
            <label class="flex items-center gap-2 text-sm mb-1">
              <input type="checkbox" id="temaAhorroEnergia" class="accent-sky-600" />
              <span>Ahorro de energÃ­a</span>
            </label>
            <textarea id="descAhorroEnergia" class="inp text-sm" rows="2" placeholder="Describe lo tratado sobre ahorro de energÃ­a..." disabled></textarea>
          </div>
          <div>
            <label class="flex items-center gap-2 text-sm mb-1">
              <input type="checkbox" id="temaConsumoEnergia" class="accent-sky-600" />
              <span>Consumo de energÃ­a</span>
            </label>
            <textarea id="descConsumoEnergia" class="inp text-sm" rows="2" placeholder="Describe lo tratado sobre consumo de energÃ­a..." disabled></textarea>
          </div>
        </div>
      </div>

      <!-- Incidencias -->
      <div class="mt-4 p-3 bg-red-50 rounded-lg border border-red-200">
        <h3 class="text-sm font-semibold text-red-700 mb-3 flex items-center gap-2">âš ï¸ Incidencias</h3>
        <div class="space-y-3">
          <div class="grid gap-3 md:grid-cols-3 items-end">
            <div class="md:col-span-2">
              <label class="lbl">Â¿Ha tenido variaciones y fluctuaciones?</label>
              <select id="incVariaciones" class="inp">
                <option value="">Seleccione...</option>
                <option value="No">No</option>
                <option value="SÃ­">SÃ­</option>
              </select>
            </div>
            <div>
              <label class="lbl">Â¿CuÃ¡ntas?</label>
              <input id="incVariacionesCant" class="inp" type="number" min="0" placeholder="0" disabled />
            </div>
          </div>
          <div class="grid gap-3 md:grid-cols-3 items-end">
            <div class="md:col-span-2">
              <label class="lbl">Â¿Ha tenido cortes de suministro de energÃ­a?</label>
              <select id="incCortes" class="inp">
                <option value="">Seleccione...</option>
                <option value="No">No</option>
                <option value="SÃ­">SÃ­</option>
              </select>
            </div>
            <div>
              <label class="lbl">Â¿CuÃ¡ntas?</label>
              <input id="incCortesCant" class="inp" type="number" min="0" placeholder="0" disabled />
            </div>
          </div>
        </div>
      </div>

      <!-- Observaciones -->
      <div class="mt-4 p-3 bg-gray-50 rounded-lg border border-gray-200">
        <label class="lbl">ğŸ“ Observaciones Generales</label>
        <textarea id="observaciones" class="inp mobile:text-base" rows="4" placeholder="Observaciones adicionales de la visita..."></textarea>
      </div>

      <!-- Campo de Reconquista -->
      <div class="mt-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-300 rounded-lg shadow-sm">
        <div class="flex items-center gap-3">
          <input id="reconquista" type="checkbox" class="accent-blue-600 w-5 h-5" />
          <label for="reconquista" class="text-base font-semibold text-blue-800 flex items-center gap-2">
            ğŸ¯ Esta es una visita de RECONQUISTA
          </label>
        </div>
        <p class="text-xs text-blue-600 mt-2 ml-8">Marca esta opciÃ³n si es una visita para recuperar un cliente</p>
      </div>

      <!-- Consentimiento -->
      <div class="mt-4 p-4 bg-green-50 border-2 border-green-200 rounded-lg">
        <div class="flex items-start gap-3">
          <input id="consent" type="checkbox" class="accent-green-600 w-5 h-5 mt-1" />
          <div>
            <label for="consent" class="text-sm font-medium text-green-800 cursor-pointer">
              âœ… Consentimiento del Cliente
            </label>
            <p class="text-xs text-green-600 mt-1">El cliente autoriza el registro y envÃ­o del acta</p>
          </div>
        </div>
      </div>

      <div class="mt-4 p-3 bg-indigo-50 rounded-lg border border-indigo-200">
        <h3 class="text-sm font-semibold text-indigo-700 mb-3 flex items-center gap-2">âœï¸ Firma del Cliente</h3>
        
        <!-- Instrucciones y estado -->
        <div class="bg-white border rounded-lg p-3 mb-3">
          <div class="flex flex-col mobile:flex-row gap-2 items-start mobile:items-center text-xs text-slate-600 mb-3">
            <span class="flex-1">ğŸ‘† Firme con el dedo dentro del recuadro</span>
            <div id="firmaStatus" class="hidden bg-green-100 text-green-800 px-2 py-1 rounded text-xs">
              âœ… Firma guardada
            </div>
          </div>
          
          <!-- Botones de control de firma -->
          <div class="flex flex-wrap gap-2 justify-center mobile:justify-end">
            <button id="btnLimpiarFirma" class="btn btn-xs btn-ghost">ğŸ—‘ï¸ Limpiar</button>
            <button id="btnProbarFirma" class="btn btn-xs btn-ghost">ğŸ§ª Probar</button>
            <button id="btnRestaurarFirma" class="btn btn-xs btn-ghost">â†©ï¸ Restaurar</button>
          </div>
        </div>
        
        <!-- Ãrea de firma -->
        <div class="bg-white border-2 border-dashed border-indigo-300 rounded-lg p-2">
          <canvas id="pad" style="width:100%; height:200px; display:block; touch-action:none; background: #fafafa;"></canvas>
        </div>
        
        <!-- Nombre del firmante -->
        <div class="mt-3 bg-white border rounded-lg p-3">
          <label class="lbl">âœï¸ Nombre del firmante</label>
          <input id="firmanteNombre" class="inp mobile:text-base" placeholder="Nombre completo del firmante" />
        </div>
      </div>

      <!-- Botones de AcciÃ³n -->
      <div class="mt-6 p-4 bg-slate-50 rounded-lg border">
        <h4 class="text-sm font-semibold text-slate-700 mb-3 text-center">ğŸ¯ Acciones del Acta</h4>
        
        <!-- Primera fila - Acciones principales -->
        <div class="grid grid-cols-2 mobile:grid-cols-1 gap-3 mb-3">
          <button id="btnGenerarPDF" class="btn btn-primary mobile:w-full mobile:text-sm mobile:py-3">ğŸ“„ Generar PDF</button>
          <button id="btnCompartir" class="btn btn-success mobile:w-full mobile:text-sm mobile:py-3">ğŸ“¤ Compartir</button>
        </div>
        
        <!-- Segunda fila - Acciones secundarias -->
        <div class="grid grid-cols-3 mobile:grid-cols-1 gap-2">
          <button id="btnDescargarPDF" class="btn btn-outline mobile:w-full mobile:text-sm mobile:py-2">ğŸ“¥ Descargar</button>
          <button id="btnGuardarExcel" class="btn btn-warning mobile:w-full mobile:text-sm mobile:py-2">ğŸ“Š Excel</button>
          <button id="btnLimpiarDuplicados" class="btn btn-danger mobile:w-full mobile:text-sm mobile:py-2">ğŸ§¹ Duplicados</button>
        </div>
        
        <!-- Tercera fila - Backup -->
        <div class="grid grid-cols-3 mobile:grid-cols-1 gap-2 mt-3">
          <button id="btnBackupManual" class="btn btn-success mobile:w-full mobile:text-sm mobile:py-2">ğŸ’¾ Backup Manual</button>
          <button id="btnBackupLocalStorage" class="btn btn-outline mobile:w-full mobile:text-sm mobile:py-2">ğŸ’¿ Local</button>
          <button id="btnRestaurarBackup" class="btn btn-warning mobile:w-full mobile:text-sm mobile:py-2">â†©ï¸ Restaurar</button>
        </div>
        
      </div>
      <p id="estado" class="text-xs text-slate-500 mt-2"></p>
    </section>

    <!-- Historial -->
    <section class="card mobile:p-3">
      <h2 class="card-title mobile:text-lg mb-4">ğŸ“š Historial de Actas</h2>
      
      <!-- BotÃ³n prominente para Dashboard -->
      <div class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-lg text-center">
        <h3 class="text-lg font-semibold text-blue-800 mb-2">ğŸ“Š Dashboard de AnÃ¡lisis</h3>
        <p class="text-sm text-blue-600 mb-3">Visualiza grÃ¡ficos, estadÃ­sticas y anÃ¡lisis detallados de tus actas</p>
        <a href="./dashboard.html" class="btn btn-primary mobile:w-full mobile:py-3 inline-flex items-center justify-center gap-2">
          ğŸ“ˆ Ver Dashboard
        </a>
      </div>
      
      <!-- EstadÃ­sticas -->
      <div id="historialStats" class="text-sm text-slate-600 mb-4 p-3 bg-slate-50 rounded-lg border"></div>
      
      <!-- Botones de gestiÃ³n del historial -->
      <div class="mb-4 p-3 bg-slate-50 rounded-lg border">
        <h4 class="text-sm font-semibold text-slate-700 mb-3 text-center">âš™ï¸ GestiÃ³n del Historial</h4>
        <div class="grid grid-cols-3 mobile:grid-cols-1 gap-2">
          <button id="btnLimpiarDuplicadosHistorial" class="btn btn-sm bg-orange-500 text-white hover:bg-orange-600 mobile:w-full mobile:py-2">
            ğŸ§¹ Duplicados
          </button>
          <button id="btnLimpiarHistorial" class="btn btn-sm bg-red-500 text-white hover:bg-red-600 mobile:w-full mobile:py-2">
            ğŸ—‘ï¸ Limpiar
          </button>
          <a href="./dashboard.html" class="btn btn-outline btn-sm mobile:w-full mobile:py-2 text-center">ğŸ“Š Dashboard</a>
        </div>
      </div>
      
      <!-- Lista de actas -->
      <div id="historial" class="space-y-3 text-sm"></div>
    </section>
  </main>

  <!-- BotÃ³n flotante para Dashboard (solo mÃ³vil) -->
  <div class="fixed bottom-4 right-4 z-50 md:hidden">
    <a href="./dashboard.html" class="bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-all duration-200 flex items-center justify-center">
      <span class="text-lg">ğŸ“Š</span>
    </a>
  </div>

  <script>
    // Habilitar/deshabilitar campos segÃºn selecciÃ³n
    document.addEventListener('DOMContentLoaded', ()=>{
      // Incidencias
      const incVariaciones = document.getElementById('incVariaciones');
      const incVariacionesCant = document.getElementById('incVariacionesCant');
      const incCortes = document.getElementById('incCortes');
      const incCortesCant = document.getElementById('incCortesCant');
      
      incVariaciones.addEventListener('change', ()=>{
        incVariacionesCant.disabled = incVariaciones.value !== 'SÃ­';
        if(incVariaciones.value !== 'SÃ­') incVariacionesCant.value = '';
      });
      
      incCortes.addEventListener('change', ()=>{
        incCortesCant.disabled = incCortes.value !== 'SÃ­';
        if(incCortes.value !== 'SÃ­') incCortesCant.value = '';
      });

      // ExenciÃ³n de contribuciÃ³n - mostrar fecha de actualizaciÃ³n
      const exencionContribucion = document.getElementById('exencionContribucion');
      const fechaActualizacionContainer = document.getElementById('fechaActualizacionContainer');
      const fechaActualizacion = document.getElementById('fechaActualizacion');
      
      exencionContribucion.addEventListener('change', ()=>{
        if(exencionContribucion.value === 'SÃ­') {
          fechaActualizacionContainer.classList.remove('hidden');
        } else {
          fechaActualizacionContainer.classList.add('hidden');
          fechaActualizacion.value = '';
        }
      });

      // Consumo de kVAR - mostrar campo de consumo
      const tieneConsumoKvar = document.getElementById('tieneConsumoKvar');
      const consumoKvarContainer = document.getElementById('consumoKvarContainer');
      const consumoKvar = document.getElementById('consumoKvar');
      
      tieneConsumoKvar.addEventListener('change', ()=>{
        if(tieneConsumoKvar.value === 'SÃ­') {
          consumoKvarContainer.classList.remove('hidden');
        } else {
          consumoKvarContainer.classList.add('hidden');
          consumoKvar.value = '';
        }
      });

      // Temas tratados
      const temas = [
        { checkbox: 'temaEnergiaEficiente', textarea: 'descEnergiaEficiente' },
        { checkbox: 'temaConexionEmcali', textarea: 'descConexionEmcali' },
        { checkbox: 'temaEtiquetaRetiq', textarea: 'descEtiquetaRetiq' },
        { checkbox: 'temaAhorroEnergia', textarea: 'descAhorroEnergia' },
        { checkbox: 'temaConsumoEnergia', textarea: 'descConsumoEnergia' }
      ];

      temas.forEach(tema => {
        const checkbox = document.getElementById(tema.checkbox);
        const textarea = document.getElementById(tema.textarea);
        
        checkbox.addEventListener('change', ()=>{
          textarea.disabled = !checkbox.checked;
          if(!checkbox.checked) textarea.value = '';
        });
      });
    });
  </script>
  <script type="module" src="./app.js"></script>
</body>
</html>
